apiVersion: xl-release/v1
kind: Templates
spec:
- directory: Delivery Insights
  children:

  - template: Track code and promote
    variables:
    - type: xlrelease.StringVariable
      key: revision
      requiresValue: false
      showOnReleaseStart: false
    - type: xlrelease.StringVariable
      key: application
      label: Name of the application
    - type: xlrelease.StringVariable
      key: branch
      label: Name of the branch
      value: master
    scriptUsername: admin
    scriptUserPassword: admin
    
    phases:
    - phase: Build
      tasks:
      - name: Run the build
        type: xlrelease.Task
        description: "Run the build in this step, you can use a Jenkins Build Task for example"
      - name: Track your code changes
        type: continuum.TrackCode
        continuumServer: Delivery Insights Service
        package: "${application}"
        group: "${branch}"
        phase: Dev
        variableMapping:
          pythonScript.revision: "${revision}"
      color: '#CC4A3C'
    - phase: QA
      tasks:
      - name: Deploy to QA
        type: xlrelease.Task
      - name: Promote code to QA
        type: continuum.PromoteAPackage
        continuumServer: Delivery Insights Service
        package: "${application}"
        phase_name: QA
      color: '#0079BC'
    - phase: Stage
      tasks:
      - name: Deploy to Stage
        type: xlrelease.Task
      - name: Promote code to Stage
        type: continuum.PromoteAPackage
        continuumServer: Delivery Insights Service
        package: "${application}"
        phase_name: Stage
      color: '#498500'
    - phase: Production
      tasks:
      - name: Deploy to Production
        type: xlrelease.Task
      - name: Promote code to Production
        type: continuum.PromoteAPackage
        continuumServer: Delivery Insights Service
        package: "${application}"
        phase_name: Production
      color: '#FFAB00'
    - phase: Post Production
      tasks:
      - name: Wait for some time
        type: xlrelease.Task
      - name: Remove card
        type: continuum.DeliverRevision
        continuumServer: Delivery Insights Service
        package: "${application}"
      color: '#991C71'

  - name: Package progression
    type: continuum.PackageProgressionDashboard
    owner: admin
    tiles:
      - name: Package progression
        type: continuum.PackageProgressionTile
        server: Delivery Insights Service
        row: 0
        col: 0
